{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/anonymousfiles/Desktop/Advanced Web Development/Project/Treasure-Hunt/MapScreen.js\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport MapView, { Marker } from 'react-native-maps';\nimport * as Location from 'expo-location';\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nfunction MapScreen() {\n  var mapRef = useRef(null);\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentCoordinates = _useState2[0],\n      setCurrentCoordinates = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      user = _useState4[0],\n      setCurrentUser = _useState4[1];\n\n  var _useState5 = useState({\n    latitude: 43.25359093653678,\n    longitude: -79.86577030001203,\n    latitudeDelta: 0.005,\n    longitudeDelta: 0.005\n  }),\n      _useState6 = _slicedToArray(_useState5, 2),\n      currRegion = _useState6[0],\n      setCurrRegion = _useState6[1];\n\n  useEffect(function () {\n    getCurrentLocation();\n    AsyncStorage.getItem(\"username\").then(function (dataFromStorage) {\n      console.log(dataFromStorage);\n      setCurrentUserName(dataFromStorage);\n    }).catch(function (error) {\n      console.log(\"Error getting dataFromStorage:\" + error);\n    });\n  }, []);\n\n  var getCurrentLocation = function getCurrentLocation() {\n    Location.requestForegroundPermissionsAsync().then(function (result) {\n      if (result.status === \"granted\") {\n        return Location.getCurrentPositionAsync({});\n      } else {\n        alert(\"You have not granted location permission. Please grant location permission from your device's Settings menu.\");\n      }\n    }).then(function (location) {\n      console.log(\"Location received: \");\n      console.log(location);\n      var coordinates = {\n        latitude: location.coords.latitude,\n        longitude: location.coords.longitude\n      };\n      console.log(coordinates);\n      mapRef.current.animateCamera({\n        center: coordinates\n      }, 2000);\n      setCurrentCoordinates(coordinates);\n    }).catch(function (error) {\n      console.log(\"Error while granting permission or while accessing current location: \" + error);\n    });\n  };\n\n  var showCaches = function showCaches(coordinates) {\n    db.collection(\"caches\").where(\"postedBy\", \"!=\", user).get().then(function (querySnapshot) {\n      if (querySnapshot.size === 0) {\n        setMsg(\"You do not have any caches to find yet\");\n      } else {\n        setMsg(\"\");\n        LocationCoords = [];\n        nearestLocations = [];\n        querySnapshot.forEach(function (doc) {\n          LocationCoords.push({\n            latitude: parseFloat(doc.data().latitude),\n            longitude: parseFloat(doc.data().longitude),\n            title: doc.data().cacheName,\n            id: doc.id\n          });\n        });\n\n        for (var i = 0; i < LocationCoords.length; i++) {\n          var dist = getDistance({\n            latitude: coordinates.lat,\n            longitude: coordinates.lng\n          }, {\n            latitude: LocationCoords[i].latitude,\n            longitude: LocationCoords[i].longitude\n          }) * 0.000621371;\n\n          if (!isNaN(dist)) {\n            var locationInfo = {\n              location: {\n                latitude: LocationCoords[i].latitude,\n                longitude: LocationCoords[i].longitude\n              },\n              distance: dist.toFixed(3),\n              title: LocationCoords[i].title,\n              id: LocationCoords[i].id\n            };\n            nearestLocations.push(locationInfo);\n          }\n\n          nearestLocations.sort(function (a, b) {\n            return a.distance - b.distance;\n          });\n        }\n\n        setCachesArray(nearestLocations);\n        setLoading(false);\n      }\n    });\n  };\n\n  var mapMoved = function mapMoved(data) {\n    console.log(data);\n    setCurrRegion(data);\n  };\n\n  return React.createElement(SafeAreaView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 9\n    }\n  }, React.createElement(MapView, {\n    style: {\n      width: Dimensions.get(\"window\").width,\n      height: Dimensions.get(\"window\").height\n    },\n    ref: mapRef,\n    initialRegion: currRegion,\n    onRegionChangeComplete: mapMoved,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 13\n    }\n  }), React.createElement(Button, {\n    title: \"Current\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 6\n    }\n  }));\n}\n\nexport default MapScreen;","map":{"version":3,"sources":["/Users/anonymousfiles/Desktop/Advanced Web Development/Project/Treasure-Hunt/MapScreen.js"],"names":["React","useEffect","useRef","useState","MapView","Marker","Location","AsyncStorage","MapScreen","mapRef","currentCoordinates","setCurrentCoordinates","user","setCurrentUser","latitude","longitude","latitudeDelta","longitudeDelta","currRegion","setCurrRegion","getCurrentLocation","getItem","then","dataFromStorage","console","log","setCurrentUserName","catch","error","requestForegroundPermissionsAsync","result","status","getCurrentPositionAsync","alert","location","coordinates","coords","current","animateCamera","center","showCaches","db","collection","where","get","querySnapshot","size","setMsg","LocationCoords","nearestLocations","forEach","doc","push","parseFloat","data","title","cacheName","id","i","length","dist","getDistance","lat","lng","isNaN","locationInfo","distance","toFixed","sort","a","b","setCachesArray","setLoading","mapMoved","width","Dimensions","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { SafeAreaView, Text, Button } from 'react-native';\nimport MapView, {Marker} from 'react-native-maps';\nimport * as Location from 'expo-location';\nimport { Dimensions } from 'react-native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nfunction MapScreen(){\n\n    const mapRef = useRef(null);\n    const [currentCoordinates, setCurrentCoordinates] = useState({});\n    const [user, setCurrentUser] = useState(\"\");\n    const [currRegion, setCurrRegion] = useState({\n        latitude: 43.25359093653678,\n        longitude: -79.86577030001203,\n        latitudeDelta: 0.005,\n        longitudeDelta: 0.005\n      })\n\n    useEffect(() =>{\n        getCurrentLocation();\n        AsyncStorage.getItem(\"username\").then((dataFromStorage) => {\n            console.log(dataFromStorage);\n            setCurrentUserName(dataFromStorage);\n        })\n        .catch((error) => {\n            console.log(\"Error getting dataFromStorage:\"+error);\n        });\n\n    }, [])\n\n    \n\n    const getCurrentLocation = () => {\n\n        Location.requestForegroundPermissionsAsync()\n        .then(\n            (result) => {\n                if(result.status === \"granted\"){\n                    return Location.getCurrentPositionAsync({});\n                }\n                else{\n                    alert(\"You have not granted location permission. Please grant location permission from your device's Settings menu.\")\n                }\n            }\n        )\n        .then(\n            (location) => {\n                \n                console.log(\"Location received: \");\n                console.log(location);\n\n                const coordinates = {\n                    latitude: location.coords.latitude,\n                    longitude: location.coords.longitude\n                }\n                console.log(coordinates);\n\n                mapRef.current.animateCamera(\n                    {center: coordinates}, 2000\n                  );\n\n                setCurrentCoordinates(coordinates);\n\n            }\n        )\n        .catch(\n            (error) => {\n\n                console.log(\"Error while granting permission or while accessing current location: \"+error);\n            }\n        )\n\n    }\n\n    const showCaches = (coordinates) => {\n        \n        \n        db.collection(\"caches\").where(\"postedBy\",\"!=\",user).get().then((querySnapshot) => {\n            if(querySnapshot.size === 0){\n                setMsg(\"You do not have any caches to find yet\");\n            }else{\n                \n                setMsg(\"\");\n                 LocationCoords=[];\n                 nearestLocations=[];\n\n                querySnapshot.forEach((doc) => {\n                    \n                  LocationCoords.push({latitude:parseFloat(doc.data().latitude), longitude:parseFloat(doc.data().longitude),title:doc.data().cacheName,id:doc.id});\n                });\n                \n                for(let i=0;i<LocationCoords.length;i++){\n                   // const dist=getDistance({latitude:43.656290660189946,longitude:-79.38017140235499},{latitude:LocationCoords[i].latitude,longitude:LocationCoords[i].longitude}) * 0.000621371;\n                 const dist=getDistance({latitude:coordinates.lat,longitude:coordinates.lng},{latitude:LocationCoords[i].latitude,longitude:LocationCoords[i].longitude}) * 0.000621371;\n                    if(!isNaN(dist)){\n                            const locationInfo = {\n                                location:{\n                                    latitude:LocationCoords[i].latitude,\n                                    longitude:LocationCoords[i].longitude\n                                },\n                               distance:dist.toFixed(3),\n                               title:LocationCoords[i].title,\n                               id:LocationCoords[i].id\n                            }\n                            nearestLocations.push(locationInfo);\n                        \n                    }   \n                    nearestLocations.sort(function (a, b) {\n                        return a.distance - b.distance;\n                      }); \n                }\n                setCachesArray(nearestLocations);\n                 setLoading(false);\n                \n               }\n            }\n          );      \n    }\n\n    const mapMoved = (data) =>{\n        console.log(data);\n        setCurrRegion(data);\n    }\n\n    return(\n        <SafeAreaView>\n            \n            <MapView\n            style={{width:Dimensions.get(\"window\").width, height:Dimensions.get(\"window\").height}}\n            ref={mapRef}\n            initialRegion={currRegion}\n            onRegionChangeComplete={mapMoved}\n     >\n\n     </MapView>\n     <Button title=\"Current\"></Button>\n        </SafeAreaView>\n    );\n}\n\nexport default MapScreen;"]},"metadata":{},"sourceType":"module"}