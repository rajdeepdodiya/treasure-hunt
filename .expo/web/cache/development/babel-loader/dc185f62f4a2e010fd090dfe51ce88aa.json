{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/anonymousfiles/Desktop/Advanced Web Development/Project/Treasure-Hunt/MapScreen.js\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport MapView, { Marker } from 'react-native-maps';\nimport * as Location from 'expo-location';\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport { getDistance } from 'geolib';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { db } from \"./FirebaseManager\";\n\nfunction MapScreen() {\n  var _this = this;\n\n  var mapRef = useRef(null);\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentCoordinates = _useState2[0],\n      setCurrentCoordinates = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentUser = _useState4[0],\n      setCurrentUser = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      allGeoCaches = _useState6[0],\n      setAllGeoCaches = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      nearbyGeoCaches = _useState8[0],\n      setNearybyGeoCaches = _useState8[1];\n\n  var _useState9 = useState({\n    latitude: 43.25359093653678,\n    longitude: -79.86577030001203,\n    latitudeDelta: 0.05,\n    longitudeDelta: 0.05\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      currRegion = _useState10[0],\n      setCurrRegion = _useState10[1];\n\n  useEffect(function () {\n    console.log(\"---------------------------\");\n    console.log(\"Getting current user from async storage\");\n    AsyncStorage.getItem(\"username\").then(function (dataFromStorage) {\n      setCurrentUser(dataFromStorage);\n    }).catch(function (error) {\n      console.log(\"Error getting username from storage:\" + error);\n    });\n    console.log(\"Current User : \" + currentUser);\n    console.log(\"---------------------------\");\n    getCurrentLocation();\n    getAllCachesFromFirebase();\n  }, []);\n\n  var getCurrentLocation = function getCurrentLocation() {\n    console.log(\"---------------------------\");\n    console.log(\"Getting current location\");\n    Location.requestForegroundPermissionsAsync().then(function (result) {\n      if (result.status === \"granted\") {\n        return Location.getCurrentPositionAsync({});\n      } else {\n        alert(\"You have not granted location permission. Please grant location permission from your device's Settings menu.\");\n      }\n    }).then(function (location) {\n      console.log(\"Location received: \");\n      console.log(location);\n      console.log(\"Extracting coordinates from received location\");\n      var coordinates = {\n        latitude: location.coords.latitude,\n        longitude: location.coords.longitude\n      };\n      console.log(coordinates);\n      console.log(\"Done extracting coordinates from received location\");\n      setCurrentCoordinates(coordinates);\n      setCurrRegion({\n        latitude: coordinates.latitude,\n        longitude: coordinates.longitude,\n        latitudeDelta: 0.05,\n        longitudeDelta: 0.05\n      });\n      mapRef.current.animateCamera({\n        center: coordinates\n      }, 2000);\n      showNearbyGeoCaches(coordinates);\n    }).catch(function (error) {\n      console.log(\"Error while granting permission or while accessing current location: \" + error);\n    });\n    console.log(\"---------------------------\");\n  };\n\n  var showNearbyGeoCaches = function showNearbyGeoCaches(newCoordinates) {\n    console.log(\"---------------------------\");\n    console.log(\"Showing nearby GeoCaches\");\n    setNearybyGeoCaches([]);\n    var loc = [];\n\n    for (var i = 0; i < allGeoCaches.length; i++) {\n      var dist = getDistance({\n        latitude: newCoordinates.latitude,\n        longitude: newCoordinates.longitude\n      }, {\n        latitude: allGeoCaches[i].latitude,\n        longitude: allGeoCaches[i].longitude\n      }) * 0.000621371;\n\n      if (!isNaN(dist)) {\n        var distance = dist.toFixed(3);\n\n        if (distance <= 25) {\n          var locationInfo = {\n            latitude: allGeoCaches[i].latitude,\n            longitude: allGeoCaches[i].longitude,\n            distance: distance,\n            title: allGeoCaches[i].title,\n            id: allGeoCaches[i].id\n          };\n          loc.push(locationInfo);\n        }\n      }\n    }\n\n    setNearybyGeoCaches(loc);\n    console.log(\"NEARBY LOCATIONS: \" + loc.length);\n    console.log(loc);\n    console.log(\"------------------------\");\n  };\n\n  var getAllCachesFromFirebase = function getAllCachesFromFirebase() {\n    console.log(\"---------------------------\");\n    console.log(\"Getting all GeoCaches from firebase\");\n    db.collection(\"caches\").where(\"postedBy\", \"!=\", currentUser).get().then(function (querySnapshot) {\n      if (querySnapshot.size === 0) {\n        console.log(\"No GeoCaches available for current user\");\n      } else {\n        var caches = [];\n        querySnapshot.forEach(function (doc) {\n          caches.push({\n            latitude: parseFloat(doc.data().latitude),\n            longitude: parseFloat(doc.data().longitude),\n            title: doc.data().cacheName,\n            id: doc.id,\n            postedBy: doc.postedBy\n          });\n        });\n        console.log(\"caches\");\n        console.log(caches);\n        setAllGeoCaches(caches);\n      }\n    }).catch(function (error) {\n      console.log(\"Error getting all caches from firebase: \" + error);\n    });\n    console.log(\"---------------------------\");\n  };\n\n  var mapMoved = function mapMoved(data) {\n    console.log(\"---------------------------\");\n    console.log(\"Map Moved\");\n    console.log(data);\n    console.log(\"---------------------------\");\n    setCurrRegion(data);\n    var coordinates = {\n      latitude: data.latitude,\n      longitude: data.longitude\n    };\n    showNearbyGeoCaches(coordinates);\n  };\n\n  return React.createElement(SafeAreaView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 9\n    }\n  }, React.createElement(MapView, {\n    style: {\n      width: Dimensions.get(\"window\").width,\n      height: Dimensions.get(\"window\").height - 10\n    },\n    ref: mapRef,\n    initialRegion: currRegion,\n    onRegionChangeComplete: mapMoved,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 9\n    }\n  }, nearbyGeoCaches.map(function (location, index) {\n    return React.createElement(Marker, {\n      coordinate: {\n        latitude: location.latitude,\n        longitude: location.longitude\n      },\n      title: location.title,\n      description: \"Cache description goes here\",\n      key: index,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 21\n      }\n    });\n  })), React.createElement(Button, {\n    title: \"Current\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 6\n    }\n  }));\n}\n\nexport default MapScreen;","map":{"version":3,"sources":["/Users/anonymousfiles/Desktop/Advanced Web Development/Project/Treasure-Hunt/MapScreen.js"],"names":["React","useEffect","useRef","useState","MapView","Marker","Location","getDistance","AsyncStorage","db","MapScreen","mapRef","currentCoordinates","setCurrentCoordinates","currentUser","setCurrentUser","allGeoCaches","setAllGeoCaches","nearbyGeoCaches","setNearybyGeoCaches","latitude","longitude","latitudeDelta","longitudeDelta","currRegion","setCurrRegion","console","log","getItem","then","dataFromStorage","catch","error","getCurrentLocation","getAllCachesFromFirebase","requestForegroundPermissionsAsync","result","status","getCurrentPositionAsync","alert","location","coordinates","coords","current","animateCamera","center","showNearbyGeoCaches","newCoordinates","loc","i","length","dist","isNaN","distance","toFixed","locationInfo","title","id","push","collection","where","get","querySnapshot","size","caches","forEach","doc","parseFloat","data","cacheName","postedBy","mapMoved","width","Dimensions","height","map","index"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { SafeAreaView, Text, Button } from 'react-native';\nimport MapView, { Marker } from 'react-native-maps';\nimport * as Location from 'expo-location';\nimport { Dimensions } from 'react-native';\nimport {getDistance} from 'geolib';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { db } from './FirebaseManager';\n\nfunction MapScreen(){\n\n    const mapRef = useRef(null);\n    const [currentCoordinates, setCurrentCoordinates] = useState({});\n    const [currentUser, setCurrentUser] = useState(\"\");\n    \n    const [allGeoCaches, setAllGeoCaches] = useState([]);\n    const [nearbyGeoCaches, setNearybyGeoCaches] = useState([]);\n\n    const [currRegion, setCurrRegion] = useState({\n        latitude: 43.25359093653678,\n        longitude: -79.86577030001203,\n        latitudeDelta: 0.05,\n        longitudeDelta: 0.05\n      });\n\n    useEffect(() =>{\n\n        console.log(\"---------------------------\");\n        console.log(\"Getting current user from async storage\");\n\n        AsyncStorage.getItem(\"username\").then((dataFromStorage) => {\n            setCurrentUser(dataFromStorage);\n        })\n        .catch((error) => {\n            console.log(\"Error getting username from storage:\"+error);\n        });\n\n        console.log(\"Current User : \"+currentUser);\n        console.log(\"---------------------------\");\n        \n        getCurrentLocation();\n        getAllCachesFromFirebase();\n\n\n    }, [])\n\n    const getCurrentLocation = () => {\n\n        console.log(\"---------------------------\");\n        console.log(\"Getting current location\");\n\n        Location.requestForegroundPermissionsAsync()\n        .then(\n            (result) => {\n                if(result.status === \"granted\"){\n                    return Location.getCurrentPositionAsync({});\n                }\n                else{\n                    alert(\"You have not granted location permission. Please grant location permission from your device's Settings menu.\")\n                }\n            }\n        )\n        .then(\n            (location) => {\n                \n                console.log(\"Location received: \");\n                console.log(location);\n\n                console.log(\"Extracting coordinates from received location\");\n\n                const coordinates = {\n                    latitude: location.coords.latitude,\n                    longitude: location.coords.longitude\n                }\n\n                console.log(coordinates);\n                console.log(\"Done extracting coordinates from received location\");\n               \n                setCurrentCoordinates(coordinates);\n                setCurrRegion({\n                    latitude: coordinates.latitude,\n                    longitude: coordinates.longitude,\n                    latitudeDelta: 0.05,\n                    longitudeDelta: 0.05\n                  });\n                \n\n                mapRef.current.animateCamera(\n                    {center: coordinates}, 2000\n                  );\n\n                  showNearbyGeoCaches(coordinates);\n        \n            }\n        )\n        .catch(\n            (error) => {\n\n                console.log(\"Error while granting permission or while accessing current location: \"+error);\n            }\n\n            \n        )\n        console.log(\"---------------------------\");\n\n    }\n\n    const showNearbyGeoCaches = (newCoordinates) => {\n\n        console.log(\"---------------------------\");\n        console.log(\"Showing nearby GeoCaches\");\n       \n        setNearybyGeoCaches([]);\n\n        let loc = [];\n        \n        for(let i=0;i<allGeoCaches.length;i++){\n\n          const dist = getDistance({latitude:newCoordinates.latitude, longitude:newCoordinates.longitude}, {latitude:allGeoCaches[i].latitude, longitude:allGeoCaches[i].longitude}) * 0.000621371;\n             \n          if(!isNaN(dist)){\n\n             const distance = dist.toFixed(3);\n             if (distance <= 25){\n\n                 const locationInfo = {\n                    latitude: allGeoCaches[i].latitude,\n                    longitude: allGeoCaches[i].longitude,\n                     distance: distance,\n                     title: allGeoCaches[i].title,\n                     id: allGeoCaches[i].id\n                 }\n                 loc.push(locationInfo);\n             }\n                 \n             }  \n\n         }\n\n         setNearybyGeoCaches(loc);\n\n         console.log(\"NEARBY LOCATIONS: \"+loc.length);\n         console.log(loc);\n         console.log(\"------------------------\");\n\n    }\n\n    const getAllCachesFromFirebase = () => {\n\n        console.log(\"---------------------------\");\n        console.log(\"Getting all GeoCaches from firebase\");\n\n        db.collection(\"caches\").where(\"postedBy\",\"!=\", currentUser).get().then((querySnapshot) => {\n            \n            if(querySnapshot.size === 0){\n                console.log(\"No GeoCaches available for current user\");\n            }else{\n                \n                const caches = [];\n\n                querySnapshot.forEach((doc) => {\n                    \n                    caches.push(\n                      { latitude: parseFloat(doc.data().latitude),\n                        longitude: parseFloat(doc.data().longitude),\n                        title: doc.data().cacheName, \n                        id: doc.id,\n                        postedBy: doc.postedBy\n                    });\n\n                });\n                console.log(\"caches\");\n                console.log(caches);\n                setAllGeoCaches(caches);\n               \n               }\n            }\n          )\n          .catch((error) => {\n              console.log(\"Error getting all caches from firebase: \"+error);\n          });      \n          console.log(\"---------------------------\");\n    }\n\n    const mapMoved = (data) => {\n        console.log(\"---------------------------\");\n        console.log(\"Map Moved\");\n        console.log(data);\n        console.log(\"---------------------------\");\n        setCurrRegion(data);\n\n        const coordinates = {\n            latitude: data.latitude,\n            longitude: data.longitude\n        }\n\n        showNearbyGeoCaches(coordinates);\n    }\n\n    return(\n        <SafeAreaView>\n            \n        <MapView\n        style={{width:Dimensions.get(\"window\").width, height:(Dimensions.get(\"window\").height - 10)}}\n        ref={mapRef}\n        initialRegion={currRegion}\n        onRegionChangeComplete={mapMoved}\n        \n        >\n            {\n                nearbyGeoCaches.map((location, index) => {\n\n                    return(\n\n                    // console.log(\"marker \"+index);\n                    // console.log(location);\n                    // console.log(Dimensions.get(\"window\").height);\n\n                    <Marker coordinate={{latitude:location.latitude, longitude: location.longitude}}\n                    title={location.title}\n                    description=\"Cache description goes here\"\n                    key={index}></Marker>\n\n                    )\n                    \n\n                    \n\n                })\n            }\n       \n\n        </MapView>\n     \n     <Button title=\"Current\"></Button>\n        </SafeAreaView>\n    );\n}\n\nexport default MapScreen;"]},"metadata":{},"sourceType":"module"}